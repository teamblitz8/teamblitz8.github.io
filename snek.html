<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>snek</title>
        <style>
            * {
                border: 0;
                margin: 0;
                padding: 0;
                font-family: Dubai;
            }
            #container {
                position:relative;
            }
            #gaem {
                display: block;
                margin: auto;
                margin-top: 2%;
                z-index: 1;
            }
            #overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 11px;
                display: none;
                margin: auto;
                background-color: #ff0000;
                opacity: 50%;
                z-index: 1000;
                width: 1280px;
                height: 960px;
                padding: 0;
            }
            .text {
                color: white;
                text-align: center;
                scale: 200%;
                padding: 10px;
            }
            #container-text {
                position: relative;
                top:350px;
            }
            button {
                position: relative;
                top: 380px;
                background-color: #f8ac29;
                margin: auto;
                display: block;
            }
        </style>
    </head>
    <body>
        <div id="container">
            <canvas id="gaem"></canvas>
            <div id="overlay">
                <div id="container-text">
                    <h1 class="text" id="scream">Game Over!</h1>
                    <p id="score" class="text">Score: Something didn't work lol</p>
                    <p id="record" class="text">Record: _ set by _</p>
                    <p id="is" class="text">You were _ away from the record!</p>
                </div>
                <button class="text" onclick="restart()">Try again</button>
            </div>
        </div>
    </body>
    <script>
        document.getElementById("overlay").style.display = "none";

        const isThatGlock = 64;
        const rows = 15;
        const columns = 20;

        let snekX = isThatGlock * 5
        let snekY = isThatGlock * 5
        let foodX;
        let foodY;

        let speedX = 0;
        let speedY = 0;

        let bod = [];

        let board;
        let context;

        let snake = new Image();
        let food = new Image();
        let bro = new Image();
        let bite = new Audio();
        let hit = new Audio();
        let soz = new Image();

        let score = 0;
        let record = 10000;
        let recorder = "Chen";
        let over = false;

        bro.src = "https://media.discordapp.net/attachments/1046176833600753676/1321584648903594065/image.png?ex=676dc51e&is=676c739e&hm=8525835aa58411c5d012f648ec65d6a4f20d458f38ef17921416e0965b81e2eb&=&format=webp&quality=lossless&width=64&height=64";
        food.src = "https://media.discordapp.net/attachments/1046176833600753676/1321498747070451783/image.png?ex=676ec69d&is=676d751d&hm=7fdca1fdbe0f7cab37e81555fbe998a4cf51559aeeb92f39ecf66752ddd376d0&=&format=webp&quality=lossless&width=64&height=64";
        snake.src = "https://media.discordapp.net/attachments/1046176833600753676/1321584800376684604/image.png?ex=676dc542&is=676c73c2&hm=c1ca37fcc10968f3cf148f9857e989a263e7ef6d3b08bb1b10887ebf6d8a34eb&=&format=webp&quality=lossless&width=64&height=64";
        bite.src = "nom.mp3";
        hit.src = "ough-47202.mp3";
        soz.src = "https://media.discordapp.net/attachments/1046176833600753676/1321584375409938432/image.png?ex=676dc4dc&is=676c735c&hm=885a280ac376ebcaa5479799c1346c98b3de9521276385573fd191516a7b04b0&=&format=webp&quality=lossless&width=64&height=64";

        let difficulty = 150.5;

        window.onload = () => {
            board = document.getElementById("gaem");
            board.height = rows * isThatGlock;
            board.width = columns * isThatGlock;
            context = board.getContext("2d");

            let placement = placeFood();
            while (placement) {
                placement = placeFood();
            }
            placement = initialiseSnek();
            while (placement) {
                placement = initialiseSnek();
            }

            setInterval(update, difficulty);
            document.addEventListener("keyup", move);
        }

        const update = () => {
            if (over) {
                return;
            }

            // gameboard
            context.fillStyle = "#1f2121";
            context.fillRect(0, 0, board.width, board.height);

            snekX += speedX * isThatGlock;
            snekY += speedY * isThatGlock;

            // when snake eats food
            if (snekX === foodX && snekY === foodY) {
                bite.play();
                difficulty += -0.5
                score++;
                bod.push([foodX, foodY]);
                placeFood();
            }

            for (let i = bod.length - 1; i > 0; i--) {
                bod[i] = bod[i - 1];
            }

            for (let i = 0; i < bod.length; i++) {
                if (!i) {
                    continue;
                }
                else if (i === bod.length - 1) {
                    const end = context.createPattern(soz, null)
                    context.fillStyle = end;
                    context.fillRect(bod[i][0], bod[i][1], isThatGlock, isThatGlock);
                }
                else {
                    const middle = context.createPattern(bro, null)
                    context.fillStyle = middle;
                    context.fillRect(bod[i][0], bod[i][1], isThatGlock, isThatGlock);
                }
            }

            // snake
            const snak = context.createPattern(snake, null)
            context.fillStyle = snak;
            context.fillRect(snekX, snekY, isThatGlock, isThatGlock);

            // food
            const fod = context.createPattern(food, null)
            context.fillStyle = fod;
            context.fillRect(foodX, foodY, isThatGlock, isThatGlock);
            
            if (snekX < 0 || snekY >= rows * isThatGlock || snekY < 0 || snekX >= columns * isThatGlock) {
                end()
                return;
            }

            for (let i of bod) {
                if (bod.length !== 1) {
                    if (snekX == i[0] && snekY == i[1]) {
                        end()
                    }
                }
            }

            if (bod.length) {
                bod[0] = [snekX, snekY];
            }
        }

        const initialiseSnek = () => {
            snekX = Math.floor(Math.random() * columns) * isThatGlock;
            snekY = Math.floor(Math.random() * rows) * isThatGlock;

            if (foodX == snekX || foodY == snekY) {
                return true;
            }
            else {
                return false;
            }
        }
        const placeFood = () => {
            foodX = Math.floor(Math.random() * columns) * isThatGlock;
            foodY = Math.floor(Math.random() * rows) * isThatGlock;

            if (foodX == snekX || foodY == snekY) {
                return true;
            }
            else {
                for (let i = 0; i < bod.length; i++) {
                    if ((bod[i][0] === foodX) || (bod[i][1] === foodY)) {
                        return true;
                    }
                    else {
                        return false;
                    }
                }
            }
        }

        const move = (event) => {
            if (event.code === "ArrowUp" && speedY != 1) {
                speedX = 0;
                speedY = -1;
            }
            else if (event.code === "ArrowDown" && speedY != -1) {
                speedX = 0;
                speedY = 1;
            }
            else if (event.code === "ArrowLeft" && speedX != 1) {
                speedX = -1;
                speedY = 0;
            }
            else if (event.code === "ArrowRight" && speedX != -1) {
                speedX = 1;
                speedY = 0;
            }
        }

        const restart = () => {
            over = false;
            score = 0;
            snekX = isThatGlock * 5
            snekY = isThatGlock * 5
            foodX = 0;
            foodY = 0;
            speedX = 0;
            speedY = 0;
            bod = [];

            let placement = placeFood();
            while (placement) {
                placement = placeFood();
            }
            placement = initialiseSnek();
            while (placement) {
                placement = initialiseSnek();
            }

            document.getElementById("overlay").style.display = "none";
        }

        const end = () => {
            hit.play();
            document.getElementById("is").innerText = `The gap to pole was ${record - score}`;
            document.getElementById("scream").innerText = "Chequered flag!"
            document.getElementById("score").innerText = `Score: ${score}`;
            document.getElementById("record").innerText = `Record: ${record} set by ${recorder}`;
            if (score > record) {
                const prev = record;
                record = score;
                let name = prompt("You broke a record! Enter your name: ");
                recorder = name;
                document.getElementById("is").innerText = `The gap to P2 was ${record - prev}`;
                document.getElementById("scream").innerText = ["And that's pole position.", "P1 baby P1!!", `And the chequered flag comes out for ${name}!`, `${name} comes across the line to take victory!`][Math.floor(Math.random() * 4)]
                document.getElementById("record").innerText = `${recorder} demolished the competition with a top score of ${score}`;
            }
            over = true;
            document.getElementById("overlay").style.display = "block";
        }
    </script>
</html>
